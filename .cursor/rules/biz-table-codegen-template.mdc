---
description: CRUD 表生成代码模板（adjust-module-biz/src/main），用于保持 Controller/Service/Mapper/DO/VO/XML 结构一致
globs: adjust-module-biz/src/main/**
alwaysApply: false
---

### 目标
当根据数据库表生成新模块代码时，生成结果必须与 `adjustment` 模块的结构/风格一致（分层、命名、接口、返回类型、分页、导出、错误码、Mapper 写法等）。

### 目录结构（必须遵循）
- `adjust-module-biz/src/main/java/com/hongguoyan/module/biz/controller/app/{biz}/App{Entity}Controller.java`
- `adjust-module-biz/src/main/java/com/hongguoyan/module/biz/controller/app/{biz}/vo/`
  - `App{Entity}PageReqVO.java`
  - `App{Entity}SaveReqVO.java`
  - `App{Entity}RespVO.java`
- `adjust-module-biz/src/main/java/com/hongguoyan/module/biz/service/{biz}/`
  - `{Entity}Service.java`
  - `{Entity}ServiceImpl.java`
- `adjust-module-biz/src/main/java/com/hongguoyan/module/biz/dal/dataobject/{biz}/{Entity}DO.java`
- `adjust-module-biz/src/main/java/com/hongguoyan/module/biz/dal/mysql/{biz}/{Entity}Mapper.java`
- `adjust-module-biz/src/main/resources/mapper/{biz}/{Entity}Mapper.xml`

> 约定：`{biz}` 是业务域（如 `adjustment`），`{Entity}` 是实体名（如 `Adjustment`），表名通常为 `biz_{biz}` 或 `biz_{xxx}`。

### Controller 模板约束
- 注解与基础：
  - `@Tag(name = "用户 APP - {中文实体名}")`
  - `@RestController`
  - `@RequestMapping("/biz/{biz}")`
  - `@Validated`
  - `@Resource private {Entity}Service {entity}Service;`
- 返回统一使用：
  - `CommonResult<T>`，并使用 `static CommonResult.success(...)`
- 必须提供的接口（路径与语义保持一致）：
  - `POST /create`：`CommonResult<Long>`，入参 `@Valid @RequestBody App{Entity}SaveReqVO`
  - `PUT /update`：`CommonResult<Boolean>`
  - `DELETE /delete?id=`：`CommonResult<Boolean>`
  - `DELETE /delete-list?ids=`：`CommonResult<Boolean>`
  - `GET /get?id=`：`CommonResult<App{Entity}RespVO>`，DO → RespVO 用 `BeanUtils.toBean`
  - `GET /page`：`CommonResult<PageResult<App{Entity}RespVO>>`，PageResult DO → RespVO 用 `BeanUtils.toBean`
  - `GET /export-excel`：
    - `@ApiAccessLog(operateType = EXPORT)`
    - `pageReqVO.setPageSize(PageParam.PAGE_SIZE_NONE)`
    - `ExcelUtils.write(response, "{中文实体名}.xls", "数据", App{Entity}RespVO.class, BeanUtils.toBean(list, App{Entity}RespVO.class))`

### Service 接口模板约束
- `{Entity}Service` 必须包含：
  - `Long create{Entity}(@Valid App{Entity}SaveReqVO createReqVO);`
  - `void update{Entity}(@Valid App{Entity}SaveReqVO updateReqVO);`
  - `void delete{Entity}(Long id);`
  - `void delete{Entity}ListByIds(List<Long> ids);`
  - `{Entity}DO get{Entity}(Long id);`
  - `PageResult<{Entity}DO> get{Entity}Page(App{Entity}PageReqVO pageReqVO);`

### Service 实现模板约束
- 类注解：`@Service`、`@Validated`
- 依赖注入：`@Resource private {Entity}Mapper {entity}Mapper;`
- create：
  - `DO obj = BeanUtils.toBean(createReqVO, DO.class);`
  - `{entity}Mapper.insert(obj);`
  - `return obj.getId();`
- update/delete：
  - 先 `validate{Entity}Exists(id)`
  - update 用 `updateById`，delete 用 `deleteById`
- delete-list：
  - `{entity}Mapper.deleteByIds(ids);`
- validateExists：
  - 不存在抛：`throw exception({ENTITY}_NOT_EXISTS);`
  - 静态导入：`ServiceExceptionUtil.exception`
  - 错误码来源：`com.hongguoyan.module.biz.enums.ErrorCodeConstants`

### Mapper 模板约束
- `@Mapper`
- `interface {Entity}Mapper extends BaseMapperX<{Entity}DO>`
- 默认分页查询必须使用：
  - `default PageResult<DO> selectPage(App{Entity}PageReqVO reqVO)`
  - `selectPage(reqVO, new LambdaQueryWrapperX<DO>() ... .betweenIfPresent(DO::getCreateTime, reqVO.getCreateTime()).orderByDesc(DO::getId))`
  - 字段过滤优先使用：`eqIfPresent`，字符串模糊用：`likeIfPresent`

### DO 模板约束
- `@TableName("{table_name}")`
- 如果需要序列（Oracle/PostgreSQL/Kingbase/DB2/H2）：`@KeySequence("{table_name}_seq")`；MySQL 可省略
- `extends BaseDO`
- Lombok：`@Data @EqualsAndHashCode(callSuper = true) @ToString(callSuper = true) @Builder @NoArgsConstructor @AllArgsConstructor`
- 主键：`@TableId private Long id;`
- 字段 JavaDoc 必须保留（用于可读性与生成一致性）

### VO 模板约束
- PageReqVO：
  - `extends PageParam`
  - `@Schema(description = "用户 APP - {中文实体名}分页 Request VO")`
  - `createTime`：`LocalDateTime[]` + `@DateTimeFormat(pattern = FORMAT_YEAR_MONTH_DAY_HOUR_MINUTE_SECOND)`
- SaveReqVO：
  - `@Schema(description = "用户 APP - {中文实体名}新增/修改 Request VO")`
  - required 字段使用 `@NotNull/@NotEmpty`，message 统一“xxx不能为空”
- RespVO：
  - `@Schema(description = "用户 APP - {中文实体名} Response VO")`
  - `@ExcelIgnoreUnannotated`
  - 每个字段 `@ExcelProperty("列名")` 以支持导出

### Mapper XML 模板约束
- 必须生成 `{Entity}Mapper.xml`
- `namespace` 必须是 Mapper 接口全限定名
- 默认保持空壳 + 说明注释；仅当出现多表/复杂 SQL 才在 XML 中写 SQL
